{
 "info": {
  "name": "E-Commerce Store API",
  "_postman_id": "ecommerce-store-api-collection-id",
  "description": "Postman collection to test E-Commerce Store user/auth and admin user management endpoints.",
  "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
 },
 "variable": [
  {
   "key": "baseUrl",
   "value": "https://localhost:5001"
  },
  {
   "key": "visitorToken",
   "value": ""
  },
  {
   "key": "adminToken",
   "value": ""
  }
 ],
 "item": [
  {
   "name": "Auth - Public",
   "item": [
    {
     "name": "Register - New Visitor (Success)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/register",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "register"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"fullName\": \"Test Visitor\",\n  \"email\": \"newvisitor@store.com\",\n  \"username\": \"newvisitor\",\n  \"password\": \"Visitor#456\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Register - Email Already Exists (409)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/register",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "register"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"fullName\": \"Another User\",\n  \"email\": \"visitor@store.com\",\n  \"username\": \"anotheruser\",\n  \"password\": \"Visitor#789\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Login - Visitor by Email (Success, sets visitorToken)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"visitor@store.com\",\n  \"password\": \"Visitor#123\"\n}"
      }
     },
     "response": [],
     "event": [
      {
       "listen": "test",
       "script": {
        "exec": [
         "if (pm.response.code === 200 || pm.response.code === 201) {",
         "  var data = pm.response.json();",
         "  if (data.token) {",
         "    pm.environment.set('visitorToken', data.token);",
         "  }",
         "}"
        ],
        "type": "text/javascript"
       }
      }
     ]
    },
    {
     "name": "Login - Visitor by Username (Success)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"visitor\",\n  \"password\": \"Visitor#123\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Login - Wrong Password (401)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"visitor@store.com\",\n  \"password\": \"WrongPassword#1\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Login - Email Not Found (404)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"unknownemail@store.com\",\n  \"password\": \"SomePassword#1\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Login - Username Not Found (404)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"unknownuser\",\n  \"password\": \"SomePassword#1\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Login - Admin (Success, sets adminToken)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/login",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "login"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"identifier\": \"admin@store.com\",\n  \"password\": \"Admin#123\"\n}"
      }
     },
     "response": [],
     "event": [
      {
       "listen": "test",
       "script": {
        "exec": [
         "if (pm.response.code === 200 || pm.response.code === 201) {",
         "  var data = pm.response.json();",
         "  if (data.token) {",
         "    pm.environment.set('adminToken', data.token);",
         "  }",
         "}"
        ],
        "type": "text/javascript"
       }
      }
     ]
    },
    {
     "name": "Current User - Visitor",
     "request": {
      "method": "GET",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/current-user",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "current-user"
       ]
      }
     },
     "response": []
    },
    {
     "name": "Current User - Admin",
     "request": {
      "method": "GET",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{adminToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/current-user",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "current-user"
       ]
      }
     },
     "response": []
    }
   ]
  },
  {
   "name": "Account - Self Service",
   "item": [
    {
     "name": "Profile - Update (Success, Visitor)",
     "request": {
      "method": "PUT",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       },
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/profile",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "profile"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"fullName\": \"Updated Visitor\",\n  \"email\": \"visitor@store.com\",\n  \"username\": \"visitor\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Profile - Update with Email Conflict (409, Visitor using admin email)",
     "request": {
      "method": "PUT",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       },
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/profile",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "profile"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"fullName\": \"Visitor Conflict\",\n  \"email\": \"admin@store.com\",\n  \"username\": \"visitor\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Change Password - Wrong Current Password (Visitor)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       },
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/change-password",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "change-password"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"currentPassword\": \"Wrong#123\",\n  \"newPassword\": \"Visitor#999\"\n}"
      }
     },
     "response": []
    },
    {
     "name": "Change Password - Success (Visitor)",
     "request": {
      "method": "POST",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       },
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/account/change-password",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "account",
        "change-password"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"currentPassword\": \"Visitor#123\",\n  \"newPassword\": \"Visitor#456\"\n}"
      }
     },
     "response": []
    }
   ]
  },
  {
   "name": "Admin - Users",
   "item": [
    {
     "name": "Get All Users (Admin)",
     "request": {
      "method": "GET",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{adminToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/admin/users",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "admin",
        "users"
       ]
      }
     },
     "response": []
    },
    {
     "name": "Get User by Id (Admin)",
     "request": {
      "method": "GET",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{adminToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/admin/users/1",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "admin",
        "users",
        "1"
       ]
      }
     },
     "response": []
    },
    {
     "name": "Update User (Admin)",
     "request": {
      "method": "PUT",
      "header": [
       {
        "key": "Content-Type",
        "value": "application/json"
       },
       {
        "key": "Authorization",
        "value": "Bearer {{adminToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/admin/users/2",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "admin",
        "users",
        "2"
       ]
      },
      "body": {
       "mode": "raw",
       "raw": "{\n  \"fullName\": \"Updated Visitor By Admin\",\n  \"email\": \"visitor@store.com\",\n  \"username\": \"visitor\",\n  \"roles\": [\"Visitor\"],\n  \"isLockedOut\": false\n}"
      }
     },
     "response": []
    },
    {
     "name": "Delete User (Admin)",
     "request": {
      "method": "DELETE",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{adminToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/admin/users/3",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "admin",
        "users",
        "3"
       ]
      }
     },
     "response": []
    },
    {
     "name": "Get All Users with Visitor Token (Expect 403)",
     "request": {
      "method": "GET",
      "header": [
       {
        "key": "Authorization",
        "value": "Bearer {{visitorToken}}",
        "type": "text"
       }
      ],
      "url": {
       "raw": "{{baseUrl}}/api/admin/users",
       "host": [
        "{{baseUrl}}"
       ],
       "path": [
        "api",
        "admin",
        "users"
       ]
      }
     },
     "response": []
    }
   ]
  }
 ]
}